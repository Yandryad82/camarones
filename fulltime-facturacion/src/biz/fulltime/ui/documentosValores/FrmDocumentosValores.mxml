<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:mx="library://ns.adobe.com/flex/mx" xmlns:s="library://ns.adobe.com/flex/spark"
		 width="100%" height="100%">

	<fx:Script>
		<![CDATA[
			import biz.fulltime.model.Documento;
			import biz.fulltime.model.DocumentoFormaPago;
			
			import mx.collections.ArrayCollection;
			import mx.core.FlexGlobals;
			import mx.core.IFlexDisplayObject;
			import mx.events.CloseEvent;
			import mx.managers.ISystemManager;
			import mx.managers.PopUpManager;
			
			import spark.components.TitleWindow;

			private var _documentosValores:ArrayCollection;

			private var _documento:Documento;
			
			[Bindable]
			private var importeTotal:BigDecimal = BigDecimal.ZERO;
			
			[Bindable]
			private var netoComprobante:BigDecimal = BigDecimal.ZERO;
			

			private function moneda_labelFunction(item:Object, column:GridColumn):String {
				return item.moneda.codigo + " - " + item.moneda.simbolo;
			}

			private function documento_labelFunction(item:Object, column:GridColumn):String {
				return item.formaPago.codigo + " - " + item.formaPago.nombre;
			}

			[Bindable]
			public function get documentosValores():ArrayCollection {
				return _documentosValores;
			}

			public function set documentosValores(value:ArrayCollection):void {
				_documentosValores = value;
			}

			protected function cmdCancel_clickHandler(event:MouseEvent):void {
				dispatchEvent(new CloseEvent(CloseEvent.CLOSE));
				
			}
			
			protected function dgDocumentosValores_doubleClickHandler(event:MouseEvent):void {
				// TODO Auto-generated method stub
				
			}
			
			protected function dgDocumentosValores_keyDownHandler(event:KeyboardEvent):void {
				// TODO Auto-generated method stub
				
			}

			[Bindable]
			public function get documento():Documento {
				return _documento;
			}

			public function set documento(value:Documento):void {
				_documento = value;
				
				if (!_documento.pagos) {
					_documento.pagos = new ArrayCollection();
				}
				
				importeTotal = BigDecimal.ZERO;
				netoComprobante = BigDecimal.ZERO;
				
				documentosValores = _documento.pagos;	

				for each (var formaPago:DocumentoFormaPago in documentosValores) {
					var importe:BigDecimal = new BigDecimal(formaPago.importe);
					var total:BigDecimal = new BigDecimal(formaPago.total);
					
					importeTotal = importeTotal.add(importe);
					netoComprobante = netoComprobante.add(total);
				}

			}
			
			
		]]>
	</fx:Script>

	<fx:Declarations>
		<s:ArrayList id="cols">
			<s:GridColumn width="40" dataField="selected" headerText="">
				<s:itemRenderer>
					<fx:Component>
						<s:GridItemRenderer>
							<fx:Script>
								<![CDATA[
									import biz.fulltime.model.DocumentoFormaPago;

									protected function checkBox_changeHandler(event:Event):void {
										DocumentoFormaPago(data).selected = checkBox.selected;
									}
								]]>
							</fx:Script>

							<s:VGroup width="100%" height="100%" horizontalAlign="center" paddingBottom="2" paddingLeft="2" paddingRight="2" paddingTop="2" verticalAlign="middle">
								<s:CheckBox id="checkBox" x="5" y="5" verticalCenter="0" change="checkBox_changeHandler(event)" selected="{DocumentoFormaPago(data).selected}" />
							</s:VGroup>
						</s:GridItemRenderer>

					</fx:Component>
				</s:itemRenderer>
			</s:GridColumn>
			<s:GridColumn dataField="documento" headerText="Documento" labelFunction="documento_labelFunction" />
			<s:GridColumn width="60" dataField="moneda" headerText="Moneda" labelFunction="moneda_labelFunction" />
			<s:GridColumn width="120" dataField="total" headerText="Monto" />
			<s:GridColumn width="120" dataField="importe" headerText="Importe" />
		</s:ArrayList>

		<s:NumberFormatter id="nf_Espanol_Espanol" locale="es_ES" />

		<s:NumberFormatter id="nf_Espanol_Espanol2" fractionalDigits="2" locale="es_ES" />
	</fx:Declarations>


	<s:Panel width="100%" height="100%" title="{documento.comprobante.nombre.toUpperCase()} Nro. {documento.serie + documento.numero}" styleName="pnlForm">
		<s:VGroup width="100%" height="100%" horizontalAlign="left" gap="0">
			<s:VGroup width="100%" height="100%" gap="10" horizontalAlign="right">
				<s:DataGrid id="dgDocumentosValores" width="100%" height="100%" doubleClick="dgDocumentosValores_doubleClickHandler(event)" keyDown="dgDocumentosValores_keyDownHandler(event)"
							sortableColumns="false" columns="{cols}" doubleClickEnabled="true" focusEnabled="true" dataProvider="{documentosValores}">
				</s:DataGrid>
				<s:HGroup paddingRight="10" paddingTop="5" horizontalAlign="right">
					<s:Label width="160" text="Total Importe: " />
					<s:Label width="80" text="{documento.moneda.simbolo} {importeTotal}" textAlign="right"/>
				</s:HGroup>
				<s:HGroup paddingRight="10" paddingTop="5" paddingBottom="10" horizontalAlign="right">
					<s:Label width="160"  text="Neto Comprobante: " />
					<s:Label width="80" text="{documento.moneda.simbolo} {netoComprobante}" textAlign="right"/>
				</s:HGroup>
			</s:VGroup>
		</s:VGroup>
		<s:controlBarContent>
			<s:HGroup width="100%" horizontalAlign="right" paddingBottom="0" paddingTop="0">
				<mx:Image id="loader1" source="@Embed(source='assets/general/logo_oscuro.gif')" alpha=".5" scaleX=".25" scaleY=".25" />
				<s:Spacer width="100%" />
				<s:Button id="cmdCancel" click="cmdCancel_clickHandler(event)" minWidth="80" styleName="cancelarButton" label="Cerrar" focusEnabled="true" toolTip="Cerrar" />
			</s:HGroup>
		</s:controlBarContent>
	</s:Panel>


</s:Group>
